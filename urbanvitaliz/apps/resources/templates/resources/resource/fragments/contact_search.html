{% load static %}
{% load django_vite %}
{% block js %}
    {% vite_asset 'js/apps/resource.js' %}
{% endblock %}
<div x-data="ResourceContactSearch({{ contacts.field.choices|length }})"
     id="contacts-list">
    <h5 class="">Contacts</h5>
    <div class="border rounded px-3 py-2">
        <div class="d-flex align-items-center mb-2">
            <svg class="bi align-baseline me-2" width="17" height="17" fill="#222">
                <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#search" />
            </svg>
            <span>Contacts selectionnés</span>
        </div>
        <ul class="list-unstyled p-0 m-0 d-flex flex-column">
            <template x-for="contact in selectedContacts">
                <li class="d-inline-flex rounded justify-content-between align-items-center px-3 py-1 bg-grey-light d-flex align-items-center mb-1">
                    <p class="mb-0 pb-0 fw-bold font-small" x-text="contact.name"></p>
                    <span @click='handleRemoveContact(event, contact)'
                          class="btn btn-outline-danger btn-sm ms-2">
                        <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                            <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#trash" />
                        </svg>
                    </span>
                </li>
            </template>
            <template x-if="selectedContacts.length == 0">
                <div class="ms-2 text-danger d-flex align-items-center">
                    <span>Pas encore de contact selectionné</span>
                </div>
            </template>
        </ul>
    </div>
    <div class="rounded py-2 mt-2">
        <div class="border-top border-start border-end py-2 pb-3">
            <div class="d-flex align-items-center mb-2 px-3">
                <svg class="bi align-baseline me-2" width="17" height="17" fill="#222">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#people" />
                </svg>
                <span>Liste des contacts</span>
            </div>
            <div class="input-item mx-3">
                <svg class="input-icon bi align-baseline me-2"
                     width="17"
                     height="17"
                     fill="#222">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg' %}#search" />
                </svg>
                <input type="search"
                       class="search input-field w-100"
                       placeholder="Rechercher"/>
            </div>
        </div>
        <div>
            <ul class="list d-flex flex-column list-unstyled border" x-ref="contactListWrapper">
                {% for id, value in contacts.field.choices %}
                    <li class="border-bottom px-3 py-2 hover-bg-grey" id="{{id}}" style="cursor: pointer;">
                        <p class="name fw-medium font-small mb-0 pb-0"
                           @click='handleAddContact(event, "{{ id }}","{{ value|lower }}")'>
                            {{ value|lower }}
                        </p>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div x-ref="contactsField" class="d-none">{{ contacts }}</div>
    </div>
</div>
