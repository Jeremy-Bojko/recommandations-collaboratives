{% load static %}
{% load sass_tags %}
{% load guardian_tags %}

{% block css %}
<link href="{% sass_src 'home/css/dsfr/marianne.css' %}"
          rel="stylesheet"
      type="text/css">
<link href="{% sass_src 'projects/css/project_navigation.css' %}"
      rel="stylesheet"
      type="text/css">
{% endblock %}

{% get_obj_perms request.user for request.site as "user_site_perms" %}
{% get_obj_perms request.user for project as "user_project_perms" %}


<ul class="project-navigation d-flex align-items-center"
    style="font-family: 'Marianne', arial, sans-serif;
           padding: 0">
    <li>
        <a class="{% if overview %} active{% endif %}"
           href="{% url 'projects-project-detail-overview' project.pk %}">
            Présentation
        </a>
    </li>
    <li class="position-relative survey">
        <a class="text-nowrap {% if state_of_play %} active{% endif %}"
           href="{% url 'projects-project-detail-knowledge' project.pk %}">
            <p>État des lieux</p>
            <div class="survey-completion">
                <div class="survey-completion-progress-bar-container">
                    <i class="survey-completion-progress-bar"
                       style="width: {{ active_project_survey_session.completion }}%;
                              {% if active_project_survey_session.completion >= 90 %}background-color:#5ec495{% else %}background-color:#f58188{% endif %}"></i>
                </div>
                <span class="survey-completion-number">{{ active_project_survey_session.completion }}%</span>
            </div>
        </a>
    </li>
    <li>
        <a class="{% if project.status == 'DRAFT' and not can_administrate %} disabled{% endif %} {% if recommandations %} active{% endif %} align-items-center"
           href="{% url 'projects-project-detail-actions' project.pk %}">
            {% if active_project_action_notifications_count %}
                    <span class="has-notification">{{ active_project_action_notifications_count }}</span>
            {% endif %}
            {% if project.status == 'DRAFT' and not can_administrate %}
                <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                </svg>
                &nbsp;
            {% endif %}
            <span>Recommandations</span>
        </a>
    </li>

    {% if "list_projects" in user_site_perms or "view_project" in user_project_perms %}
    <li>
        <a class="{% if project.status == 'DRAFT' and not can_administrate %} disabled{% endif %} {% if conversation %} active{% endif %} align-items-center"
           href="{% url 'projects-project-detail-conversations' project.pk %}">
            {% if active_project_conversation_notifications_count %}
            <span class="has-notification">{{ active_project_conversation_notifications_count }}</span>
            {% endif %}
            {% if project.status == 'DRAFT' and not can_administrate %}
            <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
            </svg>
            {% endif %}
            <span class="">Conversation</span>
        </a>
    </li>
    {% endif %}

        <li>
            {% with "Fichiers et liens" as label %}
            {% if 'manage_documents' in user_project_perms %}
            <a class="{% if files_links %}active{% endif %} align-items-center" href="{% url 'projects-project-detail-documents' project.pk %}">
                {% if active_project_document_notifications_count %}
                <span class="has-notification">{{active_project_document_notifications_count}}</span>
                {% endif %}
                <span>{{ label }}</span>
            </a>
            {% else %}
            <a class="disabled align-items-center" href="#">
                <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                </svg>
                &nbsp;
                <span>{{ label }}</span>
            </a>
            {% endif %}
            {% endwith %}
        </li>

    {% if active_project_can_administrate %}
        <li>
            <a class="{% if internal_followup %} active{% endif %} {% if not active_project_can_administrate %} disabled{% endif %}align-items-center"
               href="{% url 'projects-project-detail-internal-followup' project.pk %}">
               {% if active_project_private_conversation_notifications_count %}
                    <span class="has-notification">{{ active_project_private_conversation_notifications_count }}</span>
               {% endif %}
                {% if not active_project_can_administrate %}
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                {% endif %}
                <span class="text-nowrap">Espace conseillers</span>
            </a>
        </li>
    {% endif %}
    {% if user.is_staff %}
        <li>
            <a class="{% if administration_panel %} active{% endif %} align-items-center"
               href="{% url 'projects-project-administration' project.pk %}">
                <span class="text-nowrap">Administration</span>
            </a>
        </li>
    {% endif %}
</ul>
